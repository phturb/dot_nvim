-- DAP Configs

local dap = require("dap")

-- go DAP
local dap_go = require('dap-go')
dap_go.setup()

-- Lua/NVIM

dap.configurations.lua = {
  {
    type = 'nlua',
    request = 'attach',
    name = "Attach to running Neovim instance",
    host = function()
      local value = vim.fn.input('Host [127.0.0.1]: ')
      if value ~= "" then
        return value
      end
      return '127.0.0.1'
    end,
    port = function()
      local val = tonumber(vim.fn.input('Port: '))
      assert(val, "Please provide a port number")
      return val
    end,
  }
}

dap.adapters.nlua = function(callback, config)
  callback({ type = 'server', host = config.host, port = config.port })
end

-- JS DAP
local dap_vscode_js = require("dap-vscode-js")
dap_vscode_js.setup({
  debugger_path = os.getenv("HOME") .. "/dev/microsoft/vscode-js-debug",
  adapters = { 'pwa-node', 'pwa-chrome', 'pwa-msedge', 'node-terminal', 'pwa-extensionHost' },
})

dap.configurations["javascript"] = {
  {
    type = "pwa-node",
    request = "launch",
    name = "Launch file",
    program = "${file}",
    cwd = "${workspaceFolder}",
  },
  {
    type = "pwa-node",
    request = "attach",
    name = "Attach",
    processId = require('dap.utils').pick_process,
    cwd = "${workspaceFolder}",
  }
}

dap.configurations["typescript"] = {
  {
    type = "pwa-node",
    request = "launch",
    name = "Launch file",
    program = "${file}",
    cwd = "${workspaceFolder}",
  },
  {
    type = "pwa-node",
    request = "attach",
    name = "Attach",
    processId = require('dap.utils').pick_process,
    cwd = "${workspaceFolder}",
  }
}
